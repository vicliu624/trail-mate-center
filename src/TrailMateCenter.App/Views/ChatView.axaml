<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:TrailMateCenter.ViewModels"
             x:Class="TrailMateCenter.Views.ChatView"
             x:DataType="vm:MainWindowViewModel"
             x:Name="Root">
  <Grid ColumnDefinitions="240,*,300" RowDefinitions="*,Auto">
    <Border BorderBrush="{DynamicResource PanelBorder}" BorderThickness="0,0,1,0" Background="{DynamicResource PanelBg2}">
      <ListBox ItemsSource="{Binding Conversations}" SelectedItem="{Binding SelectedConversation}" ItemTemplate="{StaticResource ConversationTemplate}" Background="{DynamicResource PanelBg2}"/>
    </Border>

    <Border Grid.Column="1" Background="{DynamicResource SurfaceDark}" BorderBrush="{DynamicResource PanelBorder}" BorderThickness="1,0,0,0">
      <ListBox ItemsSource="{Binding FilteredMessages}"
               SelectedItem="{Binding SelectedMessage}"
               ItemTemplate="{StaticResource MessageTemplate}"
               Background="{DynamicResource SurfaceDark}"/>
    </Border>

    <Border Grid.Column="2" Grid.RowSpan="2" Background="{DynamicResource PanelBg2}" BorderBrush="{DynamicResource PanelBorder}" BorderThickness="1,0,0,0" Padding="10" Classes="panel">
      <StackPanel Spacing="8">
        <TextBlock Text="{DynamicResource Ui.Chat.NodeInfo}" FontWeight="Bold" Foreground="{DynamicResource TextDim}"/>
        <Border Background="{DynamicResource SurfaceDark}" BorderBrush="{DynamicResource PanelBorder}" BorderThickness="1" CornerRadius="6" Padding="8"
                IsVisible="{Binding DataContext.HasSelectedSubject, ElementName=Root}"
                DataContext="{Binding SelectedSubject}">
          <StackPanel Spacing="4">
            <TextBlock Text="{Binding DisplayName, TargetNullValue=--}" FontWeight="Bold" Foreground="{DynamicResource TextPrimary}"/>
            <TextBlock Text="{Binding DisplayDetail, TargetNullValue=--}" Foreground="{DynamicResource TextDim}" FontSize="10"/>
            <StackPanel Orientation="Horizontal" Spacing="6">
              <Border Width="8" Height="8" Background="{Binding StatusColor, TargetNullValue=#9AA3AE}" CornerRadius="4"/>
              <TextBlock Text="{Binding StatusText, TargetNullValue=--}" Foreground="{Binding StatusColor, TargetNullValue=#9AA3AE}" FontSize="10"/>
            </StackPanel>
            <TextBlock Text="{Binding LastSeenText, TargetNullValue=--}" Foreground="{DynamicResource TextDim}" FontSize="10"/>
            <TextBlock Text="{Binding LocationText, TargetNullValue=--}" Foreground="{DynamicResource TextDim}" FontSize="10"/>
            <TextBlock Text="{Binding UserId, TargetNullValue=--}" Foreground="{DynamicResource TextDim}" FontSize="10"/>
            <TextBlock Text="{DynamicResource Ui.Chat.Telemetry}" Foreground="{DynamicResource AccentWarn}" FontSize="10" IsVisible="{Binding HasTelemetry}"/>
            <TextBlock Text="{Binding TelemetryText}" Foreground="{DynamicResource TextDim}" FontSize="10" TextWrapping="Wrap" IsVisible="{Binding HasTelemetry}"/>
            <TextBlock Text="{Binding TelemetryTimeText}" Foreground="{DynamicResource TextDim}" FontSize="10" IsVisible="{Binding HasTelemetry}"/>
          </StackPanel>
        </Border>
        <Border Background="{DynamicResource SurfaceDark}" BorderBrush="{DynamicResource PanelBorder}" BorderThickness="1" CornerRadius="6" Padding="8"
                IsVisible="{Binding DataContext.HasNoSelectedSubject, ElementName=Root}">
          <TextBlock Text="{DynamicResource Ui.Chat.SelectNodeHint}" Foreground="{DynamicResource TextDim}" FontSize="11"/>
        </Border>
        <Button Content="{DynamicResource Ui.Chat.SetTarget}" Command="{Binding SetTargetToSelectedSubjectCommand}" IsEnabled="{Binding HasSelectedSubject}" Classes="primary" MinHeight="32"/>
        <TextBox Watermark="{DynamicResource Ui.Chat.QuickMessage}" Text="{Binding QuickMessageText, UpdateSourceTrigger=PropertyChanged}" Height="48"/>
        <Button Content="{DynamicResource Ui.Chat.QuickSend}" Command="{Binding QuickSendCommand}" Classes="primary" IsEnabled="{Binding HasSelectedSubject}" MinHeight="36"/>
        <TextBlock Text="{DynamicResource Ui.Chat.Tip}" Foreground="{DynamicResource TextDim}" FontSize="10"/>
      </StackPanel>
    </Border>

    <Border Grid.Row="1" Grid.ColumnSpan="2" Padding="8" BorderBrush="{DynamicResource PanelBorder}" BorderThickness="0,1,0,0" Background="{DynamicResource PanelBg}" Classes="panel">
      <Grid ColumnDefinitions="100,110,*,Auto,Auto" RowDefinitions="Auto" ColumnSpacing="6">
        <TextBox Grid.Column="0" Watermark="{DynamicResource Ui.Chat.Target}" Text="{Binding Target}"/>
        <ComboBox Grid.Column="1" ItemsSource="{Binding Channels}" SelectedItem="{Binding SelectedChannel}"/>
        <TextBox Grid.Column="2" Watermark="{DynamicResource Ui.Chat.MessageInput}" Text="{Binding OutgoingText, UpdateSourceTrigger=PropertyChanged}" AcceptsReturn="True" Height="56" MinWidth="240"/>
        <Button Grid.Column="3" Content="{DynamicResource Ui.Chat.Send}" Command="{Binding SendCommand}" Classes="primary" MinWidth="110" MinHeight="36"/>
        <Button Grid.Column="4" Content="{DynamicResource Ui.Chat.Retry}" Command="{Binding RetryCommand}" Classes="primary" MinWidth="80" MinHeight="36"/>
      </Grid>
    </Border>
  </Grid>
</UserControl>
