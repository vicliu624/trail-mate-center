<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:TrailMateCenter.ViewModels"
        xmlns:mapsui="using:Mapsui.UI.Avalonia"
        xmlns:views="using:TrailMateCenter.Views"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="720"
        x:Class="TrailMateCenter.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="{DynamicResource App.Title}">

    <Design.DataContext>
        <!-- This only sets the DataContext for the previewer in an IDE,
             to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
        <vm:MainWindowViewModel/>
    </Design.DataContext>


    <Grid RowDefinitions="40,*" ColumnDefinitions="*">
        <Border Grid.Row="0" Background="{DynamicResource TopBarGradient}" BorderBrush="{DynamicResource PanelBorder}" BorderThickness="0,0,0,1" Classes="panel">
            <Grid ColumnDefinitions="Auto,*,Auto" Margin="12,0">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Spacing="12">
                    <TextBlock Text="{DynamicResource App.Brand}" FontSize="16" FontWeight="Bold" Foreground="{DynamicResource TextPrimary}"/>
                    <Border Background="{DynamicResource SurfaceDark}" BorderBrush="{DynamicResource PanelBorder}" BorderThickness="1" CornerRadius="4" Padding="6,2">
                        <TextBlock Text="{Binding ConnectionStateText}" Foreground="{DynamicResource Accent}" FontSize="11"/>
                    </Border>
                    <Border Background="{DynamicResource SurfaceDark}" BorderBrush="{DynamicResource PanelBorder}" BorderThickness="1" CornerRadius="4" Padding="6,2">
                        <TextBlock Text="{Binding AprsConnectionText}" Foreground="{Binding AprsConnectionColor}" FontSize="11"/>
                    </Border>
                    <TextBlock Text="{Binding LastError}" Foreground="{DynamicResource AccentWarn}" FontSize="11"/>
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center" HorizontalAlignment="Center">
                    <ComboBox Width="260" ItemsSource="{Binding Ports}" SelectedItem="{Binding SelectedPort}">
                        <ComboBox.ItemTemplate>
                            <DataTemplate x:DataType="vm:SerialPortInfoViewModel">
                                <StackPanel>
                                    <TextBlock Text="{Binding DisplayTitle}" FontWeight="Bold"/>
                                    <TextBlock Text="{Binding DisplayDetail}" FontSize="10" Foreground="{DynamicResource TextDim}" TextWrapping="NoWrap"/>
                                </StackPanel>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                    <TextBox Width="90" Text="{Binding AckTimeoutMs}" Watermark="{DynamicResource Ui.Main.AckTimeout}"/>
                    <TextBox Width="70" Text="{Binding MaxRetries}" Watermark="{DynamicResource Ui.Main.MaxRetries}"/>
                    <CheckBox Content="{DynamicResource Ui.Main.Replay}" IsChecked="{Binding UseReplay}"/>
                    <TextBox Width="200" Watermark="{DynamicResource Ui.Main.ReplayFile}" Text="{Binding ReplayFile}"/>
                    <CheckBox Content="{DynamicResource Ui.Main.AutoConnect}" IsChecked="{Binding AutoConnectOnDetect}"/>
                    <CheckBox Content="{DynamicResource Ui.Main.AutoReconnect}" IsChecked="{Binding AutoReconnect}"/>
                </StackPanel>
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                    <Button Content="{DynamicResource Ui.Main.RefreshPorts}" Command="{Binding RefreshPortsCommand}"/>
                    <Button Content="{DynamicResource Ui.Main.Connect}" Command="{Binding ConnectCommand}"/>
                    <Button Content="{DynamicResource Ui.Main.Disconnect}" Command="{Binding DisconnectCommand}"/>
                    <StackPanel Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                        <TextBlock Text="{DynamicResource Ui.Main.Language}" Foreground="{DynamicResource TextDim}" FontSize="11"/>
                        <ComboBox Width="90"
                                  ItemsSource="{Binding Languages}"
                                  SelectedItem="{Binding SelectedLanguage}"
                                  DisplayMemberBinding="{Binding DisplayName}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                        <TextBlock Text="{DynamicResource Ui.Main.Theme}" Foreground="{DynamicResource TextDim}" FontSize="11"/>
                        <ComboBox Width="120"
                                  ItemsSource="{Binding Themes}"
                                  SelectedItem="{Binding SelectedTheme}"
                                  DisplayMemberBinding="{Binding DisplayName}"/>
                    </StackPanel>
                </StackPanel>
            </Grid>
        </Border>

        <TabControl Grid.Row="1" SelectedIndex="{Binding SelectedTabIndex}">
            <TabItem Header="{DynamicResource Ui.Tab.Dashboard}">
                <views:DashboardView/>
            </TabItem>

            <TabItem>
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <TextBlock Text="{DynamicResource Ui.Tab.Chat}"/>
                        <Border Background="{DynamicResource AccentDanger}" CornerRadius="12" Padding="8,2" IsVisible="{Binding HasUnreadChat}">
                            <TextBlock Text="{Binding UnreadChatCount}" FontSize="11" Foreground="White" FontWeight="Bold"/>
                        </Border>
                    </StackPanel>
                </TabItem.Header>
                <views:ChatView/>
            </TabItem>

            <TabItem Header="{DynamicResource Ui.Tab.Config}">
                <views:ConfigView/>
            </TabItem>

            <TabItem Header="{DynamicResource Ui.Tab.Logs}">
                <views:LogsView/>
            </TabItem>

            <TabItem Header="{DynamicResource Ui.Tab.Events}">
                <views:EventsView/>
            </TabItem>

            <TabItem Header="{DynamicResource Ui.Tab.RawFrames}">
                <views:RawFramesView/>
            </TabItem>

            <TabItem Header="{DynamicResource Ui.Tab.Export}">
                <views:ExportView/>
            </TabItem>
        </TabControl>
    </Grid>

</Window>
