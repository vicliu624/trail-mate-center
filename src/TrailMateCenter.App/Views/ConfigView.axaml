<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:TrailMateCenter.ViewModels"
             x:Class="TrailMateCenter.Views.ConfigView"
             x:DataType="vm:MainWindowViewModel">
  <ScrollViewer VerticalScrollBarVisibility="Auto">
    <StackPanel Spacing="8" Margin="12">
    <TextBlock Text="{Binding DeviceInfo}" FontWeight="Bold" Foreground="{DynamicResource TextPrimary}"/>
    <TextBlock Text="{Binding CapabilitiesInfo}" Foreground="{DynamicResource TextDim}"/>
    <TextBlock Text="{Binding StatusPanel}" Foreground="{DynamicResource TextDim}"/>
    <StackPanel Orientation="Horizontal" Spacing="8">
      <Button Content="{DynamicResource Ui.Config.Load}" Command="{Binding Config.LoadConfigCommand}"/>
      <Button Content="{DynamicResource Ui.Config.Save}" Command="{Binding Config.SaveConfigCommand}"/>
      <CheckBox Content="{DynamicResource Ui.Config.Advanced}" IsChecked="{Binding Config.IsAdvancedMode}" Foreground="{DynamicResource TextPrimary}"/>
      <TextBlock Text="{Binding Config.StatusMessage}" Foreground="{DynamicResource TextDim}"/>
    </StackPanel>
    <ListBox ItemsSource="{Binding Config.Items}" Height="300"
             Background="{DynamicResource PanelBg2}" BorderBrush="{DynamicResource PanelBorder}" BorderThickness="1">
      <ListBox.ItemTemplate>
        <DataTemplate x:DataType="vm:ConfigItemViewModel">
          <Grid ColumnDefinitions="200,*,80" Margin="0,2">
            <TextBlock Grid.Column="0" Text="{Binding KeyName}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
            <TextBox Grid.Column="1" Text="{Binding Value}" IsReadOnly="{Binding IsReadOnly}"/>
            <TextBlock Grid.Column="2" Text="{Binding IsDangerous}" VerticalAlignment="Center" Foreground="{DynamicResource TextDim}"/>
          </Grid>
        </DataTemplate>
      </ListBox.ItemTemplate>
    </ListBox>
    <Border BorderBrush="{DynamicResource PanelBorder}" BorderThickness="1" Padding="8" CornerRadius="6" Background="{DynamicResource PanelBg}">
      <StackPanel Spacing="6">
        <TextBlock Text="{DynamicResource Ui.Config.TacticalSettings}" FontWeight="Bold" Foreground="{DynamicResource TextPrimary}"/>
        <StackPanel Orientation="Horizontal" Spacing="8">
          <TextBlock Text="{DynamicResource Ui.Config.OnlineThreshold}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
          <TextBox Width="80" Text="{Binding OnlineThresholdSeconds}"/>
          <TextBlock Text="{DynamicResource Ui.Config.WeakThreshold}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
          <TextBox Width="80" Text="{Binding WeakThresholdSeconds}"/>
          <TextBlock Text="{DynamicResource Ui.Config.CommandChannel}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
          <TextBox Width="60" Text="{Binding CommandChannel}"/>
          <Button Content="{DynamicResource Ui.Config.SaveSettings}" Command="{Binding SaveSettingsCommand}"/>
        </StackPanel>
        <ListBox ItemsSource="{Binding SeverityRules}" Height="180"
                 Background="{DynamicResource PanelBg2}" BorderBrush="{DynamicResource PanelBorder}" BorderThickness="1">
          <ListBox.ItemTemplate>
            <DataTemplate x:DataType="vm:SeverityRuleViewModel">
              <Grid ColumnDefinitions="200,*,80" Margin="0,2">
                <TextBlock Grid.Column="0" Text="{Binding Kind}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
                <ComboBox Grid.Column="1"
                          ItemsSource="{Binding Options}"
                          SelectedItem="{Binding Severity}"/>
              </Grid>
            </DataTemplate>
          </ListBox.ItemTemplate>
        </ListBox>
      </StackPanel>
    </Border>
    <Border BorderBrush="{DynamicResource PanelBorder}" BorderThickness="1" Padding="8" CornerRadius="6" Background="{DynamicResource PanelBg}">
      <StackPanel Spacing="6">
        <TextBlock Text="{DynamicResource Ui.Config.AprsSettings}" FontWeight="Bold" Foreground="{DynamicResource TextPrimary}"/>
        <StackPanel Orientation="Horizontal" Spacing="8">
          <CheckBox Content="{DynamicResource Ui.Config.AprsEnable}" IsChecked="{Binding AprsEnabled}" Foreground="{DynamicResource TextPrimary}"/>
          <TextBlock Text="{Binding AprsConnectionText}" Foreground="{Binding AprsConnectionColor}" FontSize="10" VerticalAlignment="Center"/>
          <TextBlock Text="{Binding AprsStatsText}" Foreground="{DynamicResource TextDim}" FontSize="10" VerticalAlignment="Center"/>
        </StackPanel>
        <Grid ColumnDefinitions="120,*,120,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto" RowSpacing="6" ColumnSpacing="8">
          <TextBlock Grid.Row="0" Grid.Column="0" Text="{DynamicResource Ui.Config.Server}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
          <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding AprsServerHost}"/>
          <TextBlock Grid.Row="0" Grid.Column="2" Text="{DynamicResource Ui.Config.Port}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
          <TextBox Grid.Row="0" Grid.Column="3" Text="{Binding AprsServerPort}"/>

          <TextBlock Grid.Row="1" Grid.Column="0" Text="{DynamicResource Ui.Config.Callsign}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
          <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding AprsIgateCallsign}"/>
          <TextBlock Grid.Row="1" Grid.Column="2" Text="{DynamicResource Ui.Config.Ssid}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
          <TextBox Grid.Row="1" Grid.Column="3" Text="{Binding AprsIgateSsid}"/>

          <TextBlock Grid.Row="2" Grid.Column="0" Text="{DynamicResource Ui.Config.Passcode}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
          <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding AprsPasscode}" PasswordChar="●"/>
          <TextBlock Grid.Row="2" Grid.Column="2" Text="{DynamicResource Ui.Config.ToCall}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
          <TextBox Grid.Row="2" Grid.Column="3" Text="{Binding AprsToCall}"/>

          <TextBlock Grid.Row="3" Grid.Column="0" Text="{DynamicResource Ui.Config.Path}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
          <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding AprsPath}"/>
          <TextBlock Grid.Row="3" Grid.Column="2" Text="{DynamicResource Ui.Config.Filter}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
          <TextBox Grid.Row="3" Grid.Column="3" Text="{Binding AprsFilter}"/>

          <TextBlock Grid.Row="4" Grid.Column="0" Text="{DynamicResource Ui.Config.Interval}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
          <TextBox Grid.Row="4" Grid.Column="1" Text="{Binding AprsTxMinIntervalSec}"/>
          <TextBlock Grid.Row="4" Grid.Column="2" Text="{DynamicResource Ui.Config.DedupeWindow}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
          <TextBox Grid.Row="4" Grid.Column="3" Text="{Binding AprsDedupeWindowSec}"/>
        </Grid>
        <Grid ColumnDefinitions="120,*,120,*" RowDefinitions="Auto,Auto" RowSpacing="6" ColumnSpacing="8">
          <TextBlock Grid.Row="0" Grid.Column="0" Text="{DynamicResource Ui.Config.PositionInterval}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
          <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding AprsPositionIntervalSec}"/>
          <TextBlock Grid.Row="0" Grid.Column="2" Text="{DynamicResource Ui.Config.CompressPosition}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
          <CheckBox Grid.Row="0" Grid.Column="3" IsChecked="{Binding AprsUseCompressed}"/>

          <TextBlock Grid.Row="1" Grid.Column="0" Text="{DynamicResource Ui.Config.SymbolTable}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
          <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Spacing="6">
            <TextBox Width="40" Text="{Binding AprsSymbolTable}"/>
            <TextBox Width="40" Text="{Binding AprsSymbolCode}"/>
          </StackPanel>
          <TextBlock Grid.Row="1" Grid.Column="2" Text="{DynamicResource Ui.Config.TxTypes}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
          <StackPanel Grid.Row="1" Grid.Column="3" Orientation="Horizontal" Spacing="8">
            <CheckBox Content="{DynamicResource Ui.Config.TxStatus}" IsChecked="{Binding AprsEmitStatus}"/>
            <CheckBox Content="{DynamicResource Ui.Config.TxTelemetry}" IsChecked="{Binding AprsEmitTelemetry}"/>
            <CheckBox Content="{DynamicResource Ui.Config.TxWeather}" IsChecked="{Binding AprsEmitWeather}"/>
            <CheckBox Content="{DynamicResource Ui.Config.TxMessages}" IsChecked="{Binding AprsEmitMessages}"/>
            <CheckBox Content="{DynamicResource Ui.Config.TxWaypoints}" IsChecked="{Binding AprsEmitWaypoints}"/>
          </StackPanel>
        </Grid>
        <TextBlock Text="{DynamicResource Ui.Config.SaveHint}" Foreground="{DynamicResource TextDim}" FontSize="10"/>
      </StackPanel>
    </Border>
    <Border BorderBrush="{DynamicResource PanelBorder}" BorderThickness="1" Padding="8" CornerRadius="6" Background="{DynamicResource PanelBg}">
      <StackPanel Spacing="6">
        <TextBlock Text="{DynamicResource Ui.Config.MqttSettings}" FontWeight="Bold" Foreground="{DynamicResource TextPrimary}"/>
        <StackPanel Orientation="Horizontal" Spacing="8">
          <Button Content="{DynamicResource Ui.Config.MqttAddSource}" Command="{Binding AddMqttSourceCommand}"/>
          <Button Content="{DynamicResource Ui.Config.MqttRemoveSource}" Command="{Binding RemoveMqttSourceCommand}"/>
          <TextBlock Text="{DynamicResource Ui.Config.MqttHint}" Foreground="{DynamicResource TextDim}" FontSize="10" VerticalAlignment="Center"/>
        </StackPanel>
        <ListBox ItemsSource="{Binding MqttSources}" SelectedItem="{Binding SelectedMqttSource}"
                 Height="230"
                 Background="{DynamicResource PanelBg2}" BorderBrush="{DynamicResource PanelBorder}" BorderThickness="1">
          <ListBox.ItemTemplate>
            <DataTemplate x:DataType="vm:MqttSourceViewModel">
              <Border BorderBrush="{DynamicResource PanelBorder}" BorderThickness="1" Padding="8" Margin="0,2" CornerRadius="4" Background="{DynamicResource PanelBg}">
                <StackPanel Spacing="6">
                  <StackPanel Orientation="Horizontal" Spacing="10">
                    <CheckBox Content="{DynamicResource Ui.Config.MqttEnabled}" IsChecked="{Binding Enabled}" Foreground="{DynamicResource TextPrimary}"/>
                    <TextBlock Text="{Binding Name}" Foreground="{DynamicResource TextPrimary}" VerticalAlignment="Center"/>
                  </StackPanel>
                  <Grid ColumnDefinitions="90,*,70,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto" RowSpacing="6" ColumnSpacing="8">
                    <TextBlock Grid.Row="0" Grid.Column="0" Text="{DynamicResource Ui.Config.MqttName}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding Name}"/>
                    <TextBlock Grid.Row="0" Grid.Column="2" Text="{DynamicResource Ui.Config.MqttTls}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
                    <CheckBox Grid.Row="0" Grid.Column="3" IsChecked="{Binding UseTls}" VerticalAlignment="Center"/>

                    <TextBlock Grid.Row="1" Grid.Column="0" Text="{DynamicResource Ui.Config.Server}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
                    <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding Host}"/>
                    <TextBlock Grid.Row="1" Grid.Column="2" Text="{DynamicResource Ui.Config.Port}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
                    <TextBox Grid.Row="1" Grid.Column="3" Text="{Binding Port}"/>

                    <TextBlock Grid.Row="2" Grid.Column="0" Text="{DynamicResource Ui.Config.MqttTopic}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
                    <TextBox Grid.Row="2" Grid.Column="1" Grid.ColumnSpan="3" Text="{Binding Topic}"/>

                    <TextBlock Grid.Row="3" Grid.Column="0" Text="{DynamicResource Ui.Config.MqttUsername}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
                    <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding Username}"/>
                    <TextBlock Grid.Row="3" Grid.Column="2" Text="{DynamicResource Ui.Config.MqttPassword}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
                    <TextBox Grid.Row="3" Grid.Column="3" Text="{Binding Password}" PasswordChar="●"/>

                    <TextBlock Grid.Row="4" Grid.Column="0" Text="{DynamicResource Ui.Config.MqttClientId}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
                    <TextBox Grid.Row="4" Grid.Column="1" Text="{Binding ClientId}"/>
                    <TextBlock Grid.Row="4" Grid.Column="2" Text="{DynamicResource Ui.Config.MqttCleanSession}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
                    <CheckBox Grid.Row="4" Grid.Column="3" IsChecked="{Binding CleanSession}" VerticalAlignment="Center"/>

                    <TextBlock Grid.Row="5" Grid.Column="0" Text="{DynamicResource Ui.Config.MqttSubscribeQos}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
                    <TextBox Grid.Row="5" Grid.Column="1" Text="{Binding SubscribeQos}"/>
                  </Grid>
                </StackPanel>
              </Border>
            </DataTemplate>
          </ListBox.ItemTemplate>
        </ListBox>
      </StackPanel>
    </Border>
    <Border BorderBrush="{DynamicResource PanelBorder}" BorderThickness="1" Padding="8" CornerRadius="6" Background="{DynamicResource PanelBg}">
      <StackPanel Spacing="6">
        <TextBlock Text="{DynamicResource Ui.Config.ContourSettings}" FontWeight="Bold" Foreground="{DynamicResource TextPrimary}"/>
        <StackPanel Orientation="Horizontal" Spacing="8">
          <CheckBox Content="{DynamicResource Ui.Config.ContoursEnable}" IsChecked="{Binding ContoursEnabled}" Foreground="{DynamicResource TextPrimary}"/>
          <CheckBox Content="{DynamicResource Ui.Config.ContoursFine5m}" IsChecked="{Binding ContoursUltraFine}" Foreground="{DynamicResource TextPrimary}"/>
        </StackPanel>
        <Grid ColumnDefinitions="140,*" RowDefinitions="Auto" RowSpacing="6" ColumnSpacing="8">
          <TextBlock Grid.Row="0" Grid.Column="0" Text="{DynamicResource Ui.Config.EarthdataToken}" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimary}"/>
          <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding EarthdataToken}"/>
        </Grid>
        <StackPanel Orientation="Horizontal" Spacing="8">
          <Button Content="{DynamicResource Ui.Config.EarthdataTest}" Command="{Binding TestEarthdataCommand}"/>
          <TextBlock Text="{Binding EarthdataStatusText}" Foreground="{Binding EarthdataStatusColor}" VerticalAlignment="Center" FontSize="11"/>
        </StackPanel>
        <TextBlock Text="{DynamicResource Ui.Config.ContoursNote}" Foreground="{DynamicResource TextDim}" FontSize="10"/>
      </StackPanel>
    </Border>
  </StackPanel>
  </ScrollViewer>
</UserControl>
